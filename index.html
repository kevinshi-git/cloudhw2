<!DOCTYPE html>
<html>
<head>
    <title>Cloud Computing hw2</title>
    <!-- Bootstrap core CSS -->
    <link href="./assets/css/bootstrap.min.css" rel="stylesheet">
  
   
    <!-- api gateway generated sdk -->
    <script src="./assets/js/sdk/lib/axios/dist/axios.standalone.js"></script>
    <script src="./assets/js/sdk/lib/CryptoJS/rollups/hmac-sha256.js"></script>
    <script src="./assets/js/sdk/lib/CryptoJS/rollups/sha256.js"></script>
    <script src="./assets/js/sdk/lib/CryptoJS/components/hmac.js"></script>
    <script src="./assets/js/sdk/lib/CryptoJS/components/enc-base64.js"></script>
    <script src="./assets/js/sdk/lib/url-template/url-template.js"></script>
    <script src="./assets/js/sdk/lib/apiGatewayCore/sigV4Client.js"></script>
    <script src="./assets/js/sdk/lib/apiGatewayCore/apiGatewayClient.js"></script>
    <script src="./assets/js/sdk/lib/apiGatewayCore/simpleHttpClient.js"></script>
    <script src="./assets/js/sdk/lib/apiGatewayCore/utils.js"></script>
    <script src="./assets/js/sdk/apigClient.js"></script>

    <script src="./assets/js/aws-sdk.min.js"></script>
</head>
<body>

    <h1>Upload an Image!</h1> 
    <input type="file" id="imageInput" accept="image/*">
    <button id="uploadButton">Upload</button>

    <h1>Search Images</h1>
    <input type="text" id="searchInput" placeholder="Search for images">
    <button id="searchButton">Search</button>

    <button id="voiceSearchButton">Voice Search</button>


    <script>
        var sdk = apigClientFactory.newClient();
        document.getElementById('uploadButton').addEventListener('click', uploadImage);

        function uploadImage() {
            const imageInput = document.getElementById('imageInput');
            
            file = imageInput.files[0];

            const imageName =file["name"]
            bucket_name="kevinshi-b2"
            console.log(file)
            console.log(file["name"])

            if (file) {
                // Create a presigned URL for S3 PUT request
                //https://b18hgh9jv8.execute-api.us-east-1.amazonaws.com/dev2/upload/{bucket}/{key}
                
                api_name="https://b18hgh9jv8.execute-api.us-east-1.amazonaws.com/dev2/upload/"+bucket_name+"/"+imageName
                console.log("api url: ", api_name)
                fetch(api_name, {
                    method: 'PUT',
                    body: file,
                    headers: {
                        'Content-Type': file.type,
                    },
                })
                .then(response => {
                    if (response.ok) {
                        console.log('Image uploaded successfully');
                    } else {
                        console.error('Image upload failed');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
            } else {
                console.error('No file selected');
            }
        }

        document.getElementById('searchButton').addEventListener('click', searchImages);
        function searchImages() {
            const searchTerm = document.getElementById('searchInput').value;
            console.log("search term: ",searchTerm)

            if (searchTerm) {
               
                sdk.searchGet({ "q":searchTerm,
                'Access-Control-Allow-Origin':"*",
                'Access-Control-Allow-Headers':"Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token",
                'Access-Control-Allow-Methods': ['PUT'] 
            
            
                            }
            ,{},{})
                .then(response => {
                    if (response.ok) {
                        return response.json();
                    } else {
                        console.error('Search request failed');
                    }
                })
                .then(data => {
                    // Handle the response data here
                    console.log('Search results:', data);
                })
                .catch(error => {
                    console.error('Error:', error);
                });
            } else {
                console.error('Please enter a search term');
            }
        }

        function startVoiceRecognition() {
            const searchInput = document.getElementById('searchInput');
            const recognition = new webkitSpeechRecognition() || new SpeechRecognition();
            recognition.continuous = false;
            recognition.lang = 'en-US';
            
            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                searchInput.value = transcript;
            };
            
            recognition.start();
        }

        document.getElementById('voiceSearchButton').addEventListener('click', startVoiceRecognition);
    </script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <!-- <script>window.jQuery || document.write('<script src="./assets/js/vendor/jquery.min.js"><\/script>')</script> -->
    <script src="./assets/js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="./assets/js/ie10-viewport-bug-workaround.js"></script>
    <!-- custom scroll bar -->
    <script src='https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.3/jquery.mCustomScrollbar.concat.min.js'></script>
    <!-- chat js -->
</body>
</html>
